{"pageProps":{"post":"---\r\nlayout:     post\r\ntitle:      Node.js\r\nintro:   \"\"\r\ndate:       2021-9-12 12:00:01\r\nauthor:     \"Makinohara\"\r\ncatalog: true\r\ntags:\r\n    - 工程开发\r\n    \r\n---\r\n\r\n## Node.js 服务端开发\r\n\r\n### 使用express搭建基础服务器并处理请求\r\n\r\n```javascript\r\n//initialize\r\nconst Port = 3000;//设置端口号，一般是3000\r\nconst express = require('express');\r\nconst { fstat } = require('fs');\r\nconst app = express();\r\nprocess.env.PORT = Port;\r\napp.use(express.static('public'))//allow browser access resources\r\n\r\n//err catch\r\nprocess.on('uncaughtException',function(err){}) //监听未捕获的异常\r\nprocess.on('unhandledRejection',function(err,promise){}) //监听Promise没有被捕获的失败函数\r\n\r\n//传送文件的方法\r\napp.get('/borrow', (req, res) => {\r\n  res.setHeader('Content-Type','text/html');\r\n  res.sendFile('public/borrow/borrow.html',{ root : __dirname});\r\n  //由于sendFile要求使用绝对地址，所以要将根目录设置为当前文件夹\r\n})\r\n\r\napp.listen(Port, () => console.log('服务器已就绪，运行在端口'+Port))//输出服务器启动信息\r\n```\r\n\r\n### 基本的请求处理方式（以数据库为例）：\r\n\r\n```javascript\r\n//database\r\nconst mysql = require('mysql');\r\nlet databaseConnection = mysql.createConnection({\r\n  host: 'localhost',\r\n  user: 'root',\r\n  password: '123456',\r\n  database: 'books',\r\n  port: 3306\r\n});\r\ndatabaseConnection.connect();\r\n\r\napp.get('/userinfo/*', (req, res) => {\r\n  let info = req.url;\r\n  let infoS = info.split('/');\r\n  let user = infoS[2];\r\n\r\n  let returnUser;\r\n  let userSelect = 'SELECT name from users where ID = ' + user;\r\n  databaseConnection.query(userSelect, function (error, results, fields) {\r\n    if (error) throw error;\r\n    returnUser = results[0].name;\r\n    res.send(returnUser);\r\n  });\r\n\r\n})\r\n```\r\n\r\n处理表单，返回token：\r\n\r\n```js\r\napp.post('/test_postForm', function (req, res) {\r\n  let receivedForm = req.body;\r\n  console.log('表单已获取');\r\n  let token = receivedForm['user_name'];\r\n  let resUrl = '/userMain?token='+token;\r\n  res.redirect(resUrl);\r\n});\r\n```\r\n\r\n"},"__N_SSG":true}